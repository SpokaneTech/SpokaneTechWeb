{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-34QS0BNX77"></script>
    {% if DEPLOYMENT_ENV == 'production' %}
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-34QS0BNX77');
    </script>
    {% endif %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Home of the Spokane and Inland Northwest tech community">
    <meta name="keywords" content="spokane, spokanetech, tech, technology">
    <meta property="og:title" content="Spokane Tech">
    <meta property="og:description" content="Home of the Spokane and Inland Northwest tech community">
    <meta name="robots" content="noindex, nofollow">

    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'spokanetech/img/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'spokanetech/img/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'spokanetech/img/favicon-16x16.png' %}">
    <title>Spokane Tech</title>

    <link href="{% static 'node_modules/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'node_modules/@fortawesome/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'spokanetech/css/index-styles.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/tippy.js/dist/tippy.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/fun-effects/src/css/fades.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/fun-effects/src/css/blur_group.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/fun-effects/src/css/background_icons.css' %}">
    <link href="{% static 'handyhelpers/css/table_sortable.css' %}" rel="stylesheet">

</head>
<body> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <header class="fade-in-blur" style="--fade-duration: .25s;">
        <nav class="navbar">
            <div class="logo">
                <a href="" title="SpokaneTech.org home" hx-get="{% url 'web:index' %}" hx-target="#body_main" hx-push-url="{% url 'web:index' %}">Home</a>
            </div>
            
            <ul class="menu">
                <ul class="navbar-nav ms-auto flex-row align-items-center"></ul>
                <li><a href="https://discord.gg/wHrSJNgpnP" target="_blank" class="tippy-tooltip" data-tippy-content="Join us on Discord" aria-label="Join us on Discord"><i class="fa-brands fa-discord"></i></a></li>
                <li><a href="" hx-get="{% url 'web:get_techgroups' display='list' %}" hx-target="#body_main" hx-push-url="{% url 'web:get_techgroups' display='list' %}" class="tippy-tooltip" data-tippy-content="View our tech groups" aria-label="View our tech groups">
                    <i class="fa-solid fa-user-group"></i></a>
                </li>
                <li><a href="" hx-get="{% url 'web:get_events' display='list' %}" hx-target="#body_main" hx-push-url="{% url 'web:get_events' display='list' %}" class="tippy-tooltip" data-tippy-content="List upcoming events" aria-label="List upcoming events">
                    <i class="fa-solid fa-list-check"></i></a>
                </li>
                <li><a href="" hx-get="{% url 'web:event_calendar' year=0 month=0 %}" hx-target="#body_main" hx-push-url="{% url 'web:event_calendar' year=0 month=0 %}" class="tippy-tooltip" data-tippy-content="Calendar of events"> 
                  <i class="fa-solid fa-calendar-days"></i></a>
                </li>
                {% if user.is_authenticated %}
                <li><a href="" hx-get="{% url 'members:stats' %}" hx-target="#body_main" hx-push-url="{% url 'members:stats' %}" class="tippy-tooltip" data-tippy-content="Member Statistics"> 
                  <i class="fa-solid fa-chart-simple"></i></a>
                </li>
                <li>
                    <a href="" hx-get="{% url 'members:detail_member' request.user.pk %}" hx-target="#body_main" hx-push-url="{% url 'members:detail_member' request.user.pk %}" class="tippy-tooltip" data-tippy-content="User profile" aria-label="User profile">
                      <i class="fa-solid fa-user"></i>
                    </a>
                </li>
                <li>
                    <form action="{% url 'account_logout' %}" method="post" style="display: inline;">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-link ps-1 py-0 m-0 align-baseline tippy-tooltip" data-tippy-content="Log out" aria-label="Log out">
                        <i class="fa-solid fa-right-from-bracket"></i>
                      </button>
                    </form>
                </li>
                {% else %}
                <li><a href=""
                    hx-get="{% url 'members:login' %}" hx-target="#body_main" hx-push-url="{% url 'members:login'%}"
                    class="tippy-tooltip" data-tippy-content="Log in">
                    <i class="fa-solid fa-right-to-bracket"></i></a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </header>
 
    {# include toasts #}
    <div aria-live="polite" aria-atomic="true" class="position-relative">
        <div class="toast-container position-fixed top-0 end-0 p-3"></div>
    </div>

    {% if messages %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            {% for message in messages %}
                console.log("Calling showToast with message:", "{{ message|escapejs }}");
                showToast("{{ message|escapejs }}");
            {% endfor %}
        });
    </script>
    {% endif %}

    {% block main_content %}
    <main id="body_main"></main>
    {% endblock main_content %}
 
    <footer class="fade-in-blur" style="--fade-duration: .75s;">
        <p class="title">SpokaneTech.org</p>
        <p class="copyright">&copy; 2025 spokantech.org. All rights reserved.</p>
    </footer>

    {% block modals %}
    {% if not disable_modals_in_base %}
    {% include 'handyhelpers/htmx/bs5/generic_modal.htm' %}
    {% endif %}
    {% endblock modals %}

    <script type="text/javascript" src="{% static 'node_modules/htmx.org/dist/htmx.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'node_modules/jquery/dist/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'node_modules/@popperjs/core/dist/umd/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'node_modules/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'spokanetech/js/bgicons.js' %}"></script>
    <script type="text/javascript" src="{% static 'node_modules/tippy.js/dist/tippy-bundle.umd.min.js' %}"></script>

    <!-- Initialize Tippy.js -->
    <script>
        tippy('.tippy-tooltip', {
            placement: 'bottom',
            animation: 'fade',
            arrow: true,
        });
    </script>

    <script>
    let chartInstances = [];
  
    document.addEventListener('htmx:afterSwap', function (evt) {
      const chartWrappers = evt.target.querySelectorAll('[data-chart-type]');
  
      chartWrappers.forEach(wrapper => {
        const type = wrapper.dataset.chartType;
        const labels = JSON.parse(wrapper.dataset.labels || '[]');
        const data = JSON.parse(wrapper.dataset.counts || '[]');
        const canvas = wrapper.querySelector('canvas');
        if (!canvas) return;
  
        const ctx = canvas.getContext('2d');
        const chart = new Chart(ctx, {
          type: type,
          data: {
            labels: labels,
            datasets: [{
              label: wrapper.dataset.title || '',
              data: data,
              backgroundColor: 'rgba(75, 192, 192, 0.6)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                display: false,
                },
                tooltip: {
                bodyFont: {
                    size: 14
                },
                titleFont: {
                    size: 14
                }
                }
            },
            scales: {
                x: {
                ticks: {
                    color: '#ffffff', // Font color for x-axis labels
                    font: {
                    size: 12
                    }
                },
                grid: {
                    color: 'rgba(255,255,255,0.1)' // Optional: light grid lines
                }
                },
                y: {
                ticks: {
                    color: '#ffffff', // Font color for y-axis labels
                    font: {
                    size: 12
                    }
                },
                grid: {
                    color: 'rgba(255,255,255,0.1)'
                },
                beginAtZero: true
                }
            }
            }
        });
  
        chartInstances.push(chart);
      });
    });
  
    // Resize all charts on window resize
    window.addEventListener('resize', function () {
      chartInstances.forEach(chart => chart.resize());
    });
    </script>
    
    <script>
        // Function to create and show a toast
        function showToast(message) {
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                console.error('Toast container not found in the DOM.');
                return;
            }
            const toastElement = document.createElement('div');
            toastElement.classList.add('toast');
            toastElement.setAttribute('role', 'alert');
            toastElement.setAttribute('aria-live', 'assertive');
            toastElement.setAttribute('aria-atomic', 'true');
            toastElement.setAttribute('data-bs-delay', '5000');
            toastElement.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">Notification</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            toastContainer.appendChild(toastElement);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        }

        // Check for HTMX response headers
        document.addEventListener('htmx:afterRequest', (event) => {
            const message = event.detail.xhr.getResponseHeader('X-Toast-Message');
            if (message) {
                showToast(message);
            }
        });
    </script>


{% block project_javascript_extra %}
<script type="text/javascript" src="{% static 'handyhelpers/js/table_sortable.js' %}"></script>
{% endblock project_javascript_extra %}

</body>
</html>
